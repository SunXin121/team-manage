{% extends "base.html" %}

{% block title %}邀请记录 - GPT Team 管理系统{% endblock %}

{% block content %}
<div class="page-header">
    <h2>邀请记录</h2>
</div>

<!-- 统计卡片 -->
<div class="stats-container">
    <div class="stat-card">
        <div class="stat-icon"><i data-lucide="users" style="width: 20px; height: 20px;"></i></div>
        <div class="stat-info-group">
            <div class="stat-value">{{ stats.total }}</div>
            <div class="stat-label">总记录</div>
        </div>
    </div>
    <div class="stat-card stat-success">
        <div class="stat-icon"><i data-lucide="calendar" style="width: 20px; height: 20px;"></i></div>
        <div class="stat-info-group">
            <div class="stat-value">{{ stats.today }}</div>
            <div class="stat-label">今日</div>
        </div>
    </div>
    <div class="stat-card stat-info">
        <div class="stat-icon"><i data-lucide="calendar-days" style="width: 20px; height: 20px;"></i></div>
        <div class="stat-info-group">
            <div class="stat-value">{{ stats.this_week }}</div>
            <div class="stat-label">本周</div>
        </div>
    </div>
    <div class="stat-card stat-danger">
        <div class="stat-icon"><i data-lucide="calendar-range" style="width: 20px; height: 20px;"></i></div>
        <div class="stat-info-group">
            <div class="stat-value">{{ stats.this_month }}</div>
            <div class="stat-label">本月</div>
        </div>
    </div>
</div>

<!-- 搜索筛选 -->
<div class="content-section">
    <div class="section-header" style="border-bottom: none; padding-bottom: 0;">
        <h3 style="font-size: 1rem; font-weight: 600;">搜索筛选</h3>
        {% if filters.email or filters.code or filters.order_no or filters.source_type or filters.team_id or filters.start_date or filters.end_date %}
        <a href="/admin/invite-records" class="btn btn-secondary" style="width: auto; padding: 6px 16px;">
            <i data-lucide="x" style="width: 14px; height: 14px;"></i> 清除筛选
        </a>
        {% endif %}
    </div>

    <form action="/admin/invite-records" method="get" style="padding: 0 20px 20px 20px;">
        <div class="search-form-grid">
            <div class="form-group">
                <label>邮箱</label>
                <input type="text" name="email" class="form-control" placeholder="搜索邮箱..."
                    value="{{ filters.email or '' }}">
            </div>
            <div class="form-group">
                <label>兑换码</label>
                <input type="text" name="code" class="form-control" placeholder="搜索兑换码..."
                    value="{{ filters.code or '' }}">
            </div>
            <div class="form-group">
                <label>订单号</label>
                <input type="text" name="order_no" class="form-control" placeholder="搜索订单号..."
                    value="{{ filters.order_no or '' }}">
            </div>
            <div class="form-group">
                <label>来源类型</label>
                <select name="source_type" class="form-control">
                    <option value="">全部</option>
                    <option value="redeem_code" {{ 'selected' if filters.source_type == 'redeem_code' else '' }}>兑换码</option>
                    <option value="payment" {{ 'selected' if filters.source_type == 'payment' else '' }}>支付</option>
                    <option value="after_sales" {{ 'selected' if filters.source_type == 'after_sales' else '' }}>售后换车</option>
                    <option value="admin_manual" {{ 'selected' if filters.source_type == 'admin_manual' else '' }}>手动添加</option>
                </select>
            </div>
            <div class="form-group">
                <label>Team ID</label>
                <input type="text" name="team_id" class="form-control" placeholder="Team ID..."
                    value="{{ filters.team_id or '' }}">
            </div>
            <div class="form-group">
                <label>开始日期</label>
                <input type="date" name="start_date" class="form-control" value="{{ filters.start_date or '' }}">
            </div>
            <div class="form-group">
                <label>结束日期</label>
                <input type="date" name="end_date" class="form-control" value="{{ filters.end_date or '' }}">
            </div>
            <div class="form-group" style="display: flex; align-items: flex-end;">
                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    <i data-lucide="search" style="width: 14px; height: 14px;"></i> 搜索
                </button>
            </div>
        </div>
    </form>
</div>

<!-- 记录列表 -->
<div class="content-section">
    <div class="section-header">
        <h3 style="font-size: 1rem; font-weight: 600;">记录列表</h3>
        <span class="pagination-info" style="font-size: 0.8125rem;">共 {{ pagination.total }} 条记录</span>
    </div>

    {% if records %}
    <div class="table-container">
        <table class="data-table">
            <thead>
                <tr>
                    <th>邮箱</th>
                    <th>来源</th>
                    <th>订单号</th>
                    <th>Team ID</th>
                    <th>邀请时间</th>
                </tr>
            </thead>
            <tbody>
                {% for record in records %}
                <tr>
                    <td>{{ record.email }}</td>
                    <td>
                        {% if record.source_type == 'redeem_code' %}
                        <span class="status-badge status-active">兑换码</span>
                        {% elif record.source_type == 'payment' %}
                        <span class="status-badge status-info">支付</span>
                        {% elif record.source_type == 'after_sales' %}
                        <span class="status-badge" style="background: rgba(255, 149, 0, 0.1); color: #ff9500;">售后换车</span>
                        {% elif record.source_type == 'admin_manual' %}
                        <span class="status-badge" style="background: rgba(142, 142, 147, 0.1); color: #8e8e93;">手动添加</span>
                        {% else %}
                        <span class="status-badge">{{ record.source_type or '-' }}</span>
                        {% endif %}
                    </td>
                    <td>{{ record.order_no or '-' }}</td>
                    <td>{{ record.team_id or '-' }}</td>
                    <td>{{ record.invited_at or '-' }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 分页 -->
    {% if pagination and pagination.total_pages > 1 %}
    <div class="pagination">
        {% set filter_params = '' %}
        {% if filters.email %}{% set filter_params = filter_params + '&email=' + filters.email %}{% endif %}
        {% if filters.code %}{% set filter_params = filter_params + '&code=' + filters.code %}{% endif %}
        {% if filters.order_no %}{% set filter_params = filter_params + '&order_no=' + filters.order_no %}{% endif %}
        {% if filters.source_type %}{% set filter_params = filter_params + '&source_type=' + filters.source_type %}{% endif %}
        {% if filters.team_id %}{% set filter_params = filter_params + '&team_id=' + filters.team_id %}{% endif %}
        {% if filters.start_date %}{% set filter_params = filter_params + '&start_date=' + filters.start_date %}{% endif %}
        {% if filters.end_date %}{% set filter_params = filter_params + '&end_date=' + filters.end_date %}{% endif %}

        {% if pagination.current_page > 1 %}
        <a href="?page=1{{ filter_params }}" class="btn btn-sm btn-secondary">首页</a>
        <a href="?page={{ pagination.current_page - 1 }}{{ filter_params }}" class="btn btn-sm btn-secondary">
            <i data-lucide="chevron-left" style="width: 14px; height: 14px;"></i>
        </a>
        {% endif %}
        <span class="pagination-info">第 {{ pagination.current_page }} / {{ pagination.total_pages }} 页</span>
        {% if pagination.current_page < pagination.total_pages %}
        <a href="?page={{ pagination.current_page + 1 }}{{ filter_params }}" class="btn btn-sm btn-secondary">
            <i data-lucide="chevron-right" style="width: 14px; height: 14px;"></i>
        </a>
        <a href="?page={{ pagination.total_pages }}{{ filter_params }}" class="btn btn-sm btn-secondary">末页</a>
        {% endif %}
    </div>
    {% endif %}
    {% else %}
    <div class="empty-state">
        <i data-lucide="inbox" style="width: 48px; height: 48px; opacity: 0.15;"></i>
        <p style="margin-top: 12px;">暂无邀请记录</p>
    </div>
    {% endif %}
</div>
{% endblock %}
